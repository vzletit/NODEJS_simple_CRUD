
# NODE JS CRUD API with clustering
(RS School NodeJS course project)

An HTTP server that can process CRUD requests (get/add/update/delete users) and interact with the database both synchronously and via IPC.
The application operates in one of two modes:

**single** — Single server created, communication with the database occurs synchronously. Actual API URL: **http://localhost:4000/api/users**

**multi** — Master (db runner) creates several servers by number of CPU cores, assigns them to different ports and sequentially distributes incoming HTTP requests upon them (Round-robin algorithm). Communication with the database occurs asynchronously via IPC. Actual API URL: **http://localhost:4000/api**



## Installation

After project is cloned and switched to *dev* branch, install dependencies:

```bash
  npm install
```
    
## Build

To build the project bundle, run:

```bash
  npm run build
```
To build JS bundle and run it in SINGLE mode:
```bash
npm run start:prod
```
To build JS bundle and run it in MULTI mode:
```bash
npm run start:prod:multi
```


## Running with nodemon

Compile TS to JS and run in SINGLE mode:
```bash
npm run start:dev
```
Compile TS to JS and run in MULTI mode:
```bash
npm run start:dev:multi
```


## API Reference

*API Reference here uses SINGLE mode API URL: **/api/users**. In MULTI mode use **/api** instead.*

#### Get all users

```http
  GET /api/users
```
Server will return array of users and *200* status code.


#### Get user by ID

```http
  GET /api/users/${id}
```
Server will return user object and *200* status code. If user not exists — will return *404* code. If *id* is not valid *uuid* — will return *400*.

#### Add new user

```http
  POST /api/users
```
User is an JSON object sent to server in *body* field. Object should contain fields:

| Field | Type     | Description                |
| :-------- | :------- | :------------------------- |
| `id` | `string` | Will be generated by server |
| `username` | `string` | New user's name. **Required** |
| `age` | `number` | New user's age. **Required** |
| `hobbies` | `array` | New user's hobbies. **Required** (but can be empty)|

Server will return user object with generated *id* and *201* status code. If new user's object is not valid JSON — status code *500* and error message will be returned.

#### Update existing user by ID

```http
  PUT /api/users/${id}
```
User is an JSON object, similar to new user (above). 
Server will return updated user object and *200* status code. If user not exists — will return *404* code. If *id* is not valid *uuid* — will return *400*. If update user's object is not valid JSON — status code *500* and error message will be returned.


#### Delete existing user by ID

```http
  DELETE /api/users/${id}
```
Server will return *204* status code. If user not exists — will return *404* code. If *id* is not valid *uuid* — will return *400*.




## Running Tests

To run tests, run the following command:

```bash
  npm run test
```

